
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAd.LoaderManager",superclass:iAd.Loader,synthesizedProperties:["length"]});iAd.LoaderManager.DID_PROGRESS="loaderDidProgress";iAd.LoaderManager.prototype.init=function(a){this.callSuper();this._progress=0;this.loaders=a||[];this.pendingLoaders=this.loaders.slice();this.failedLoaders=[];this.completedLoaders=[];this.openLoaders=[]};iAd.LoaderManager.prototype.add=function(a){if(this.contains(a)){iAd.Console.warn(this.constructor.displayName+": Unable to add loader again if already managed.");return false}if(a.error||a.loaded||a.loading){iAd.Console.warn(this.constructor.displayName+": Unable to add a loader that has already started to load.");return false}this.loaders.push(a);this.pendingLoaders.push(a);if(this.loading){this.updateProgress()}return true};iAd.LoaderManager.prototype.remove=function(a){if(this.loading){iAd.Console.warn(this.constructor.displayName+": Unable to remove loaders from a manager that has already started to load.");return false}if(this.contains(a)&&this.pendingLoaders.indexOf(a)==-1){iAd.Console.warn(this.constructor.displayName+": Unable to remove a loader that has already started to load.");return false}var b=iAd.Array.removeObjectFromArray(a,this.loaders);iAd.Array.removeObjectFromArray(a,this.pendingLoaders);return b};iAd.LoaderManager.prototype.clear=function(){if(this.loading){iAd.Console.warn(this.constructor.displayName+": You cannot clear while loading is in progress.");return}this.resetLoaderArrays();this.updateProgress()};iAd.LoaderManager.prototype.contains=function(a){return this.loaders.indexOf(a)!=-1};iAd.LoaderManager.prototype.resetLoaderArrays=function(){this.pendingLoaders=[];this.completedLoaders=[];this.openLoaders=[];this.failedLoaders=[];this.loaders=[]};iAd.LoaderManager.prototype.getProgress=function(){return this._progress};iAd.LoaderManager.prototype.updateProgress=function(){var g=this.length;if(g==0){this._progress=0;return}var f=this.loaders,d=0,b=0,a,c;for(var e=0;e<g;e++){a=f[e];c=a.length||1;d+=c;b+=c*a.progress}this._progress=b/d};iAd.LoaderManager.prototype.getLength=function(){return this.loaders.length};iAd.LoaderManager.prototype.startLoad=function(){this._progress=0;this.openLoaders=[];this.completedLoaders=[];this.failedLoaders=[]};iAd.LoaderManager.prototype.abortLoad=function(){for(var a=0,b=this.openLoaders.length;a<b;a++){this.openLoaders[a].abort()}return true};iAd.LoaderManager.prototype.loadNextItem=function(){if(this.pendingLoaders.length==0){return}var a=this.pendingLoaders.shift();this.openLoaders.push(a);a._manager=this;a.callMethodNameAfterDelay("load",0)};iAd.LoaderManager.prototype.loaderDidComplete=function(a){this.completedLoaders.push(a);this.loaderDidEnd(a)};iAd.LoaderManager.prototype.loaderDidFail=function(a,b){this.failedLoaders.push(a);this.loaderDidEnd(a)};iAd.LoaderManager.prototype.loaderDidProgress=function(a,c,b){this.notifyLoaderDidProgress(b||a)};iAd.LoaderManager.prototype.loaderDidEnd=function(a){iAd.Array.removeObjectFromArray(a,this.openLoaders);delete a._manager;this.notifyLoaderDidProgress(a)};iAd.LoaderManager.prototype.notifyLoaderDidProgress=function(a){this.updateProgress();this.dispatchLoaderNotification(iAd.Loader.DID_PROGRESS,[["progress",this.progress],["relatedLoader",a]])};