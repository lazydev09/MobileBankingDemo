
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAd.StackController",superclass:iAd.ViewController,synthesizedProperties:["viewControllers","topViewController","visibleViewController"],archivedProperties:["viewControllers"]});iAd.StackController.WILL_SHOW_VIEW_CONTROLLER="navigationControllerWillShowViewControllerAnimated";iAd.StackController.DID_SHOW_VIEW_CONTROLLER="navigationControllerDidShowViewControllerAnimated";iAd.StackController.prototype.init=function(b,a){this.callSuper(b);this.delegate=null;this._viewControllers=[];this.autoReversesTransitions=false;this.previousController=null;this.viewAppearancePropagationProperty="visibleViewController";this.shouldArchiveView=false;this.delayedSetOperationArguments=null;this.backingTransitionController=new iAd.TransitionController();this.backingTransitionController.delegate=this;if(a!=undefined){this.viewControllers=[a]}};iAd.StackController.prototype.loadView=function(){this.view=new iAd.StackControllerView();this.hostView=this._view.addSubview(this.backingTransitionController.view);this.hostView.layer.addClassName("ad-stack-controller-host-view");this.performDelayedSetOperation()};iAd.StackController.prototype.unloadView=function(){if(this.hostView){this.hostView.removeFromSuperview();this.hostView=null}this.callSuper()};iAd.StackController.prototype.didReceiveMemoryWarning=function(){this.callSuper();var b=this._viewControllers.length-(this._view?2:0);for(var a=0;a<b;a++){this._viewControllers[a].unloadView()}};iAd.StackController.prototype.getTopViewController=function(){return(this.viewControllers.length>0)?this.viewControllers[this.viewControllers.length-1]:null};iAd.StackController.prototype.getVisibleViewController=function(){var a=this.topViewController;return a.modalViewController||a};iAd.StackController.prototype.getViewControllers=function(){return(this.delayedSetOperationArguments!=null)?this.delayedSetOperationArguments[0]:this._viewControllers};iAd.StackController.prototype.setViewControllers=function(a){this.setViewControllersAnimated(a,false)};iAd.StackController.prototype.setViewControllersAnimated=function(g,e){if(g.length==0){return}if(this.shouldDelaySetOperation()){this.delayedSetOperationArguments=arguments;return}iAd.Transaction.begin();var f=(this._viewControllers.length>0)?this._viewControllers[this._viewControllers.length-1]:null;var a=g[g.length-1];var h=(this._viewControllers.indexOf(a)!=-1);var c=(!f&&e)?this.shouldAnimateInitialViewController():e;this.dispatchWillShowNotification(a,c);for(var b=0,d=this._viewControllers.length;b<d;b++){this._viewControllers[b].parentViewController=null}for(var b=0,d=g.length;b<d;b++){g[b].parentViewController=this}this._viewControllers=g;this.prepareViewControllersForTransition(f,a,h);this.backingTransitionController.setVisibleViewControllerAnimated(a,c);iAd.Transaction.commit()};iAd.StackController.prototype.prepareViewControllersForTransition=function(b,c,a){if(b==null){c.becomesVisibleTransition=c.becomesTopItemTransition}else{if(b!==c){if(this.autoReversesTransitions){b.becomesHiddenTransition=a?b.wasTopItemTransition:c.becomesBackItemTransition;c.becomesVisibleTransition=a?b.wasBackItemTransition:c.becomesTopItemTransition}else{b.becomesHiddenTransition=a?b.wasTopItemTransition:b.becomesBackItemTransition;c.becomesVisibleTransition=a?c.wasBackItemTransition:c.becomesTopItemTransition}}}};iAd.StackController.prototype.shouldDelaySetOperation=function(){return !this.isViewLoaded()||this.backingTransitionController.busy};iAd.StackController.prototype.shouldAnimateInitialViewController=function(){return true};iAd.StackController.prototype.pushViewControllerAnimated=function(a,b){if(this.viewControllers.indexOf(a)!=-1){iAd.Console.warn("iAd.StackController.prototype.pushViewControllerAnimated: attempt to push a view controller already in the stack");return}this.setViewControllersAnimated(this.viewControllers.concat([a]),b)};iAd.StackController.prototype.popViewControllerAnimated=function(b){if(this.viewControllers.length>1){var a=this.topViewController;this.setViewControllersAnimated(this.viewControllers.slice(0,this.viewControllers.length-1),b);return a}return null};iAd.StackController.prototype.popToRootViewControllerAnimated=function(a){return this.popToViewControllerAnimated(this.viewControllers[0],a)};iAd.StackController.prototype.popToViewControllerAnimated=function(a,c){var d=this.viewControllers.indexOf(a);if(d<0||d>=this.viewControllers.length-1){return[]}var b=this.viewControllers.slice(d+1);this.setViewControllersAnimated(this.viewControllers.slice(0,d+1),c);return b};iAd.StackController.prototype.transitionControllerWillMakeViewControllerVisibleAnimated=function(a,d,c,b){};iAd.StackController.prototype.transitionControllerDidMakeViewControllerVisibleAnimated=function(b,d,a,c){this.dispatchDidShowNotification(d,c);this.performDelayedSetOperation()};iAd.StackController.prototype.dispatchDidShowNotification=function(b,a){this.dispatchNotification(iAd.StackController.DID_SHOW_VIEW_CONTROLLER,this.delegate,[["viewController",b],["animated",a]])};iAd.StackController.prototype.dispatchWillShowNotification=function(b,a){this.dispatchNotification(iAd.StackController.WILL_SHOW_VIEW_CONTROLLER,this.delegate,[["viewController",b],["animated",a]])};iAd.StackController.prototype.performDelayedSetOperation=function(){if(this.delayedSetOperationArguments==null){return}this.setViewControllersAnimated(this.delayedSetOperationArguments[0],this.delayedSetOperationArguments[1]);this.delayedSetOperationArguments=null};iAd.Class({name:"iAd.StackControllerView",superclass:iAd.View,cssClassName:"ad-stack-controller-view"});iAd.StackControllerView.prototype.init=function(a){this.callSuper(a);this.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT};iAd.StackControllerView.prototype.willMoveToSuperview=function(a){this.callSuper(a);if(a!=null&&this._size.equals(iAd.Size.ZERO_SIZE)){this.size=a.size.copy()}};iAd.ViewController.prototype.getStackController=function(){return this.parentControllerOfKind(iAd.StackController)};iAd.RootViewController.prototype.getStackController=function(){if(!this.hasOwnProperty("_stackController")){this.stackController=new iAd.StackController()}return this._stackController};iAd.RootViewController.prototype.setStackController=function(b){var a=this.view;b.view.size=a._size.copy();b.delegate=this;a.addSubview(b.view);this._stackController=b};iAd.Class.synthesizeProperties(iAd.RootViewController,["stackController"]);