
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAd.Image",synthesizedProperties:["width","height","loaded"],archivedProperties:["url","hasHiDPIVersion"]});iAd.Image.prototype.init=function(b,a){this.callSuper();this.url=b;this.resolvedURL=iAd.Image.resolveURL(b,a);this.hasHiDPIVersion=a;this._loaded=false;this.scaleFactor=(a&&iAd.Device.HAS_HIDPI_DISPLAY)?0.5:1;this.element=new Image();this.load();iAd.Image.imageWasCreated(this)};iAd.Image.prototype.getWidth=function(){return this.element.width*this.scaleFactor};iAd.Image.prototype.getHeight=function(){return this.element.height*this.scaleFactor};iAd.Image.prototype.handleEvent=function(a){if(a.type==="load"&&(a.target===this.element)){this.loaded=true;this.element.removeEventListener("load",this,false);this.runCompletion(false)}};iAd.Image.prototype.load=function(){this.element.src=this.resolvedURL;if(this.element.complete){this.loaded=true}else{this.element.addEventListener("load",this,false)}};iAd.Image.prototype.whenLoaded=function(b,a){this.whenLoadedArguments={completion:b,methodName:a};if(this._loaded){this.runCompletion(true)}};iAd.Image.prototype.runCompletion=function(a){var b=this.whenLoadedArguments;if(!b){return}if(iAd.Utils.objectIsFunction(b.completion)){b.completion(this,a)}else{if(iAd.Utils.objectHasMethod(b.completion,b.methodName)){b.completion[b.methodName](this,a)}}delete this.whenLoadedArguments};iAd.Image.imageForURL=function(b,a){if(!b){return null}var c=iAd.Image.resolveURL(b,a);if(this.instances&&this.instances[c]){return this.instances[c]}return new iAd.Image(b,a)};iAd.Image.restoreFromArchive=function(a){return this.imageForURL(a.url,a.hasHiDPIVersion)};iAd.Image.resolveURL=function(b,a){return(a&&iAd.Device.HAS_HIDPI_DISPLAY)?iAd.Path.appendHiDPISuffix(b):b};iAd.Image.imageWasCreated=function(a){if(!this.instances){this.instances={};window.setTimeout(iAd.Image.runLoopDidStart,0)}this.instances[a.resolvedURL]=a};iAd.Image.runLoopDidStart=function(){delete iAd.Image.instances};