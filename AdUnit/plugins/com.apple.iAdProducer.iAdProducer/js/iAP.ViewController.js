
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAP.ViewController",superclass:iAd.ViewController,synthesizedProperties:["readyToTransition","nextViewController"],archivedProperties:["readyToTransition","nextViewController"]});iAP.ViewController.ORIENTATION_UNKNOWN=0;iAP.ViewController.ORIENTATION_PORTRAIT=1;iAP.ViewController.ORIENTATION_PORTRAIT_UPSIDE_DOWN=2;iAP.ViewController.ORIENTATION_LANDSCAPE_LEFT=3;iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT=4;iAP.ViewController.VIEW_DID_SHAKE="viewControllerViewDidShake";iAd.ViewController.TRANSITION_IN_FROM_RIGHT=function(b){var a=b.size.width;return{properties:["transform"],from:["translateX("+a+"px)"],to:["translateX(0)"]}};iAd.ViewController.TRANSITION_IN_FROM_LEFT=function(b){var a=-b.size.width;return{properties:["transform"],from:["translateX("+a+"px)"],to:["translateX(0)"]}};iAd.ViewController.TRANSITION_OUT_TO_RIGHT=function(b){var a=b.size.width;return{properties:["transform"],from:["translateX(0)"],to:["translateX("+a+"px)"]}};iAd.ViewController.TRANSITION_OUT_TO_LEFT=function(b){var a=-b.size.width;return{properties:["transform"],from:["translateX(0)"],to:["translateX("+a+"px)"]}};iAP.ViewController.prototype.init=function(a){this.nextViewControllerID=null;this.callSuper(a);if(!this.configuration.properties){this.configuration.properties={}}var l=this;Object.defineProperty(this.configuration.properties,"autoAdvanceToNextViewController",{get:function(){iAd.Console.warn('Checking "viewController.configuration.properties.autoAdvanceToNextViewController" is no longer supported. Use "viewController.autoAdvanceToNextViewController" instead.');return l.autoAdvanceToNextViewController},set:function(i){iAd.Console.warn('Setting "viewController.configuration.properties.autoAdvanceToNextViewController" is no longer supported. Use "viewController.autoAdvanceToNextViewController" instead.');l.autoAdvanceToNextViewController=i;return l.autoAdvanceToNextViewController}});this._readyToTransition=false;this._shouldPreloadNextViewControllers=true;this._orientationCode=iAP.ViewController.ORIENTATION_UNKNOWN;this._additionalImages=[];this.becomesReadyToTransitionWhenViewsAreLoaded=true;this.shouldArchiveView=false;var j=iAP.EventDelegate.viewControllerScriptFunctions[a.id];if(j){var d=new iAP.EventDelegate(this,this,j);d.processUserScript()}var k=null;if(this.transitionDuration){k=parseFloat(this.transitionDuration)}var b=["wasBackItemTransition","becomesBackItemTransition","wasTopItemTransition","becomesTopItemTransition","becomesHiddenTransition"];for(var c=0,f=b.length;c<f;c++){var e=b[c];var g=this[e];if(g){if(k>0){if(iAd.Utils.objectIsFunction(g)){this[e]=(function(i){return function(m){var n=i(m);n.revertsToOriginalValues=true;n.duration=k;return n}})(g)}else{var h={};iAd.Utils.copyPropertiesFromSourceToTarget(g,h);this[e]=g=h;g.revertsToOriginalValues=true;g.duration=k}}else{this[e]=null}}}if(!!iAd.Device.iOS_VERSION){document.addEventListener("focus",this,true);document.addEventListener("blur",this,true)}};iAP.ViewController.prototype.clearScrollToTopTimer=function(){if(this._scrollToTopTimer){clearTimeout(this._scrollToTopTimer);this._scrollToTopTimer=null}};iAP.ViewController.prototype.handleEvent=function(b){var a=b.type;if(a=="orientationchange"&&this.orientation==iAP.ViewController.ORIENTATION_UNKNOWN){if(window.orientation==0){this.setOrientation(iAP.ViewController.ORIENTATION_PORTRAIT)}else{if(window.orientation==-90){this.setOrientation(iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT)}else{if(window.orientation==180){this.setOrientation(iAP.ViewController.ORIENTATION_PORTRAIT_UPSIDE_DOWN)}else{if(window.orientation==90){this.setOrientation(iAP.ViewController.ORIENTATION_LANDSCAPE_LEFT)}}}}}else{if(a=="focus"&&this.contentView){this.contentView.layer.style.overflow="hidden";this.clearScrollToTopTimer()}else{if(a=="blur"&&this.contentView){this.contentView.layer.style.overflow="visible";if(!iAd.Device.iOSVersionLessThan("5.0")){this.clearScrollToTopTimer();this._scrollToTopTimer=setTimeout(function(){window.scrollTo(0,0)},100)}}}}this.callSuper(b)};iAP.ViewController.prototype.getNextViewController=function(){return this.nextViewControllerID?iAd.ViewController.instances[this.nextViewControllerID]:null};iAP.ViewController.prototype.setNextViewController=function(a){this.nextViewControllerID=a.id};iAP.ViewController.prototype.preloadNextViewController=function(){if(!this.nextViewController){return}if(this.nextViewController.readyToTransition){this.viewControllerIsReadyToTransition(this.nextViewController)}else{this.nextViewController.addPropertyObserver("readyToTransition",this,"viewControllerIsReadyToTransition")}this.nextViewController.loadRequiredFiles()};iAP.ViewController.prototype.preloadViewControllers=function(){var d=this.nextViewController;if(d){if(iAP.PrerollViewController&&d instanceof iAP.PrerollViewController&&d.nextViewController.id){this.callMethodNameAfterDelay("skipPrerollViewController",d.loadingTimeoutDuration)}this.preloadNextViewController(d)}if(this.viewControllerIDsToPreload){for(var a=0,c=this.viewControllerIDsToPreload.length;a<c;a++){var b=iAd.ViewController.instances[this.viewControllerIDsToPreload[a]];b.loadRequiredFiles()}}};iAP.ViewController.prototype.skipPrerollViewController=function(){var a=this.nextViewController;if(a.readyToTransition){return}a.removePropertyObserver("readyToTransition",this);this.nextViewController=a.nextViewController;this.preloadNextViewController()};iAP.ViewController.prototype.transitionToViewControllerWithID=function(a){this.transitionToViewControllerWithIDAnimated(a,true)};iAP.ViewController.prototype.transitionToViewControllerWithIDAnimated=function(e,b){var c=iAd.ViewController.instances[e];if(c==null){iAd.Console.warn("Attempted to transition to a view controller with an invalid id: "+e);return}var a=this.getStackController();var d=(a.viewControllers.indexOf(c)!=-1);if(d){a.popToViewControllerAnimated(c,b)}else{a.pushViewControllerAnimated(c,b)}};iAP.ViewController.prototype.viewControllerIsReadyToTransition=function(d){if(!d){return}if(!d.readyToTransition){return}d.removePropertyObserver("readyToTransition",this);if(d.configuration.id!=this.nextViewController.id){return}if(this.autoAdvanceToNextViewController){var b=this.minimumDelayBeforeTransition;b=(b==null?0:parseFloat(b));var c=this._timeViewControllerAppeared;var a=(c==null?0:Date.now()-c)/1000;if(a<b){clearTimeout(this._transitionTimer);this._transitionTimer=this.callMethodNameAfterDelay("viewControllerIsReadyToTransition",b-a,d);return}if(this.buildInActionListShouldDelayTransition&&this.isInState(iAd.TransitionController.VIEW_BUILDS_IN_STATE)){return}this.transitionToViewControllerWithID(d.configuration.id)}};iAP.ViewController.prototype.exitState=function(a){var b=this.callSuper(a);if(a==iAd.TransitionController.VIEW_BUILDS_IN_STATE){if(this.buildInActionListShouldDelayTransition){this.viewControllerIsReadyToTransition(this.nextViewController)}if(this.minimumDelayBeforeTransition==null&&iAd.Device.iOSVersionLessThan("5.0")){this.cancelActionList(this.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_IN_ACTION_LIST_CLASS])}}return b};iAP.ViewController.prototype.viewDidLoad=function(){this.callSuper();var c=iAP.EventDelegate.viewScriptFunctions[this.configuration.id];var b,d;for(d in c){b=this.outlets[d];var a=new iAP.EventDelegate(b,b,c[d]);b.viewController=this;b.userInteractionEnabled=true;a.processUserScript()}for(d in this.outlets){b=this.outlets[d];if(iAd.Analytics&&iAd.Analytics._observedObjects[b.id]!=null){b.userInteractionEnabled=true}}};iAP.ViewController.prototype.viewWillAppear=function(c){var a=this.orientation;if(window.iAPDebug!=null){window.iAPDebug.transitioningToViewController(this.configuration.id);if(a!=null){var b=iAd.Transaction.defaults.duration/2;setTimeout(function(){window.iAPDebug.rotateToOrientation(a)},b*1000)}}this.setOrientation(a);window.addEventListener("orientationchange",this,false);this.callSuper(c)};iAP.ViewController.prototype.viewDidAppear=function(a){this.callSuper(a);this._timeViewControllerAppeared=Date.now();if(this._shouldPreloadNextViewControllers&&(this.nextViewController||this.viewControllerIDsToPreload)){this.preloadViewControllers()}if(iAd.Utils.isRunningInAdContext){window.ad.shakeEventsListener=this}this.loadAdditionalFiles();if(this.contentView){this.contentView.viewDidAppear()}};iAP.ViewController.prototype.viewWillDisappear=function(a){this.callSuper(a);clearTimeout(this._transitionTimer);if(iAd.Utils.isRunningInAdContext){window.ad.shakeEventsListener=null}};iAP.ViewController.prototype.loadRequiredFiles=function(){if(window.iAPDebug!=null){var a=this.configuration.requiredFileURIs;var b=a.stylesheets.concat(a.scripts,a.images);b.push(a.contentView);window.iAPDebug.willRequestAssetsForViewController(this.configuration.id,b)}this.callSuper()};iAP.ViewController.prototype.loadAdditionalFiles=function(){if(this._didLoadAdditionalFiles||!this.configuration.additionalFileURIs||!this.configuration.additionalFileURIs.images){return}var d=this.configuration.additionalFileURIs.images;for(var b=0,c=d.length;b<c;b++){var a=document.createElement("img");a.src=(iAd.Device.HAS_HIDPI_DISPLAY&&this.configuration.hasHiDPIVersion)?iAd.Path.appendHiDPISuffix(d[b]):d[b];document.head.appendChild(a)}this._didLoadAdditionalFiles=true};iAP.ViewController.prototype.shakeEventDidOccur=function(){this.createAndDispatchEvent(iAP.ViewController.VIEW_DID_SHAKE)};iAP.ViewController.prototype.setOrientation=function(b){var c=false;if(b==iAP.ViewController.ORIENTATION_LANDSCAPE_LEFT||b==iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT){c=true;this.enterState("ad-landscape")}else{this.exitState("ad-landscape")}if(iAd.Utils.isRunningInAdContext==false&&navigator.userAgent.match(/iPad/i)){if((c&&window.innerWidth==1024)||(c==false&&window.innerWidth==768)){this.contentView.size=new iAd.Size(window.innerWidth,window.innerHeight)}}if(window.ad!=null&&b!=null){if(window.ad.hasOwnProperty("currentSupportedInterfaceOrientations")){var a=ADAd.ADInterfaceOrientationPortrait|ADAd.ADInterfaceOrientationPortraitUpsideDown|ADAd.ADInterfaceOrientationLandscapeLeft|ADAd.ADInterfaceOrientationLandscapeRight;var e=0;switch(b){case iAP.ViewController.ORIENTATION_PORTRAIT:e=ADAd.ADInterfaceOrientationPortrait;case iAP.ViewController.ORIENTATION_PORTRAIT_UPSIDE_DOWN:e=e||ADAd.ADInterfaceOrientationPortraitUpsideDown;if(iAd.Device.IS_IPAD){a=ADAd.ADInterfaceOrientationPortrait|ADAd.ADInterfaceOrientationPortraitUpsideDown}else{a=ADAd.ADInterfaceOrientationPortrait}break;case iAP.ViewController.ORIENTATION_LANDSCAPE_LEFT:e=ADAd.ADInterfaceOrientationLandscapeRight;case iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT:e=e||ADAd.ADInterfaceOrientationLandscapeLeft;a=ADAd.ADInterfaceOrientationLandscapeLeft|ADAd.ADInterfaceOrientationLandscapeRight;if(iAP.ViewController.initialOrientation&&iAP.ViewController.initialOrientation==="-90"){window.ad.currentSupportedInterfaceOrientations=ADAd.ADInterfaceOrientationLandscapeLeft;setTimeout(function(){window.ad.currentSupportedInterfaceOrientations=a},0);if(iAd.RootViewController.sharedRootViewController!=this){delete iAP.ViewController.initialOrientation}return}break}if(window.iAPDebug&&a!=e){window.ad.currentSupportedInterfaceOrientations=e;setTimeout(function(){window.ad.currentSupportedInterfaceOrientations=a},0)}else{window.ad.currentSupportedInterfaceOrientations=a}if(iAd.RootViewController.sharedRootViewController!=this){delete iAP.ViewController.initialOrientation}}else{if(window.ad.hasOwnProperty("setContentOrientation")){if(this.primaryOrientation=="landscape"){if(b==iAP.ViewController.ORIENTATION_PORTRAIT){var d,f;if(window.orientation==-90){d=90;f="translateY(-"+window.innerWidth+"px)"}else{d=-90;f="translateX(-"+window.innerHeight+"px)"}this.view.setLayerStyle({"-webkit-transform":"rotate("+d+"deg) "+f,"-webkit-transform-origin":"0% 0%"})}}else{window.ad.setContentOrientation(b);if(b==iAP.ViewController.ORIENTATION_LANDSCAPE_RIGHT){this.view.setLayerStyle({"-webkit-transform":"rotate(270deg) translateX(-"+window.innerHeight+"px)","-webkit-transform-origin":"0% 0%"})}}}}}};iAP.ViewController.prototype.requiredFilesLoaderDidComplete=function(a){this.callSuper(a);if(this.loadedAllRequiredFiles&&this.becomesReadyToTransitionWhenViewsAreLoaded){this.readyToTransition=true}if(window.editorProxy){editorProxy.didInitializeContentView()}};(function(){var a=localStorage.getItem("iAP:Banner:Orientation");localStorage.removeItem("iAP:Banner:Orientation");if(window.ad&&iAd.Device.iOSVersionLessThan("5.0")){iAP.ViewController.initialOrientation=a}})();