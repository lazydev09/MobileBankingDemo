
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Analytics={_observedObjects:{},_messagesById:{},_uid:1};iAd.Analytics.logsToConsole=false;iAd.Analytics.NAME_TO_SYMBOL_MAP={analyticsObjectId:"as",analyticsName:"an",analyticsType:"at",analyticsSectionId:"k"};iAd.Analytics.log=function(d){if(d==null){iAd.Console.warn("iAd.Analytics.log requires a valid parameter.");return}var a={};var b;for(var c in d){if(c in this.NAME_TO_SYMBOL_MAP){a[this.NAME_TO_SYMBOL_MAP[c]]=d[c]}else{if(b==null){b={}}b[c]=d[c]}}if(b!=null){a.a=b}var e={v:iAd.VERSION};e[Date.now()]=a;this.composeMessage(e)};iAd.Analytics.setMessageForId=function(a,b){if(!b||!a){return}this._messagesById[b]=a};iAd.Analytics.updateMessageWithId=function(c,a){var b=this._messagesById[c];if(b&&a){iAd.Utils.copyPropertiesFromSourceToTarget(a,b)}};iAd.Analytics.logMessageWithId=function(e,b,c){var d=this._messagesById[e];if(d){var a={};iAd.Utils.copyPropertiesFromSourceToTarget(d,a);if(c&&c.analyticsDetails){iAd.Utils.copyPropertiesFromSourceToTarget(c.analyticsDetails,a)}if(b){iAd.Utils.copyPropertiesFromSourceToTarget(b,a)}for(key in a){value=a[key];a[key]=iAd.Utils.objectIsFunction(value)?value.call(c||this):value}this.log(a)}};iAd.Analytics.logEvent=function(d,c,b){var f=c.id||c._analyticsId;if(!f){return}var a=this._observedObjects[f];if(!a){return}var e=a[d];if(!e){return}e.forEach(function(g){this.logMessageWithId(g,b,c)},this)};iAd.Analytics.registerMessageForEvent=function(b,d,a){if(!a){return}var f;if(iAd.Utils.objectIsString(a)){f=a}else{if(a.id){f=a.id}else{if(a._analyticsId){f=a._analyticsId}else{f=a._analyticsId=this.uniqueId()}}}if(!d||!b){return}var c=this._observedObjects[f];if(!c){c=this._observedObjects[f]={}}var e=c[d];if(!e){e=c[d]=[]}if(e.indexOf(b)==-1){e.push(b)}};iAd.Analytics.unregisterMessageForEvent=function(b,d,a){if(!a){return}var f=iAd.Utils.objectIsString(a)?a:a.id||a._analyticsId;if(!f||!d||!b){return}var c=this._observedObjects[f];if(!c){return}var e=c[d];if(!e){return}iAd.Array.removeObjectFromArray(b,e)};iAd.Analytics.composeMessage=function(b){var a=JSON.stringify(b);if(window.hasOwnProperty("ad")){window.ad.reportClickEvent(a)}if(this.logsToConsole){iAd.Console.log("[ANALYTICS]: "+a)}};iAd.Analytics.processAnalyticsWithConfiguration=function(d){var c=d.messages;if(c){for(var b in c){this.setMessageForId(c[b],b)}}var a=d.messagesForEvents;if(a){a.forEach(function(e){this.registerMessageForEvent(e.messageId,e.eventType,e.objectId)},this)}};iAd.Analytics.uniqueId=function(){return"analytics-"+this._uid++};