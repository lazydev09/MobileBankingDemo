
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Archiver={};iAd.Archiver._uid=1;iAd.Archiver.WILL_ENCODE_OBJECT="willEncodeObjectToArchive";iAd.Archiver.DID_ENCODE_OBJECT="didEncodeObjectToArchive";iAd.Archiver.WILL_RESTORE_OBJECT="willRestoreFromArchive";iAd.Archiver.DID_RESTORE_OBJECT="didRestoreFromArchive";iAd.Archiver.archive=function(c,a){if(!a){a={};return{__root:this.archive(c,a),__objects:a}}if(iAd.Utils.objectIsPrimitive(c)){return c}else{if(iAd.Utils.objectIsArray(c)){return c.map(function(h){return this.archive(h,a)},this)}}var f=c._uid||(c._uid=this._uid++);if(!a[f]){var e=a[f]={};if(c instanceof iAd.Object){var d=c.constructor;e.__className=d._name;var b=this.archivePropertiesForClass(d);if(iAd.Utils.objectHasMethod(c,iAd.Archiver.WILL_ENCODE_OBJECT)){c[iAd.Archiver.WILL_ENCODE_OBJECT](e)}for(var g in b){e[g]=this.archive(c.archiveProperty(g),a)}if(iAd.Utils.objectHasMethod(c,iAd.Archiver.DID_ENCODE_OBJECT)){c[iAd.Archiver.DID_ENCODE_OBJECT](e)}}else{for(var g in c){if(g!="_uid"){e[g]=this.archive(c[g],a)}}}}return{_uid:f}};iAd.Archiver.archiveToJSON=function(a){return JSON.stringify(this.archive(a))};iAd.Archiver.archivePropertiesForClass=function(g){var d=g._archivePropertyMap;if(d){return d}d=g._archivePropertyMap={};var f=g.superclass;if(f){iAd.Utils.copyPropertiesFromSourceToTarget(this.archivePropertiesForClass(f),d)}var e=g.archivedProperties||[];for(var a=0,c=e.length;a<c;a++){d[e[a]]=true}var b=g.excludedProperties||[];for(a=0,c=b.length;a<c;a++){delete d[b[a]]}return d};iAd.Archiver.restoreFromArchive=function(b,a,j){if(iAd.Utils.objectIsPrimitive(b)){return b}else{if(b.__root){return this.restoreFromArchive(b.__root,b.__objects,{})}else{if(b._uid){var f=b._uid;return j[f]||(j[f]=this.restoreFromArchive(a[f],a,j))}else{if(iAd.Utils.objectIsArray(b)){return b.map(function(k){return this.restoreFromArchive(k,a,j)},this)}else{var g={};for(var i in b){if(i!="__className"){g[i]=this.restoreFromArchive(b[i],a,j)}}if(b.__className){var d=iAd.Utils.resolveObjectPath(b.__className);var c=d;var e;do{e=c.restoreFromArchive}while(!e&&(c=c.superclass));var h=e?e.call(d,g):new d();if(iAd.Utils.objectHasMethod(h,iAd.Archiver.WILL_RESTORE_OBJECT)){h[iAd.Archiver.WILL_RESTORE_OBJECT](b)}for(var i in g){h.restoreProperty(i,g[i])}if(iAd.Utils.objectHasMethod(h,iAd.Archiver.DID_RESTORE_OBJECT)){h[iAd.Archiver.DID_RESTORE_OBJECT](b)}return h}else{return g}}}}}};iAd.Archiver.restoreWithJSONArchive=function(a){return a?this.restoreFromArchive(JSON.parse(a)):null};iAd.Archiver.objectReferences={};iAd.Archiver.referenceForObject=function(b){var a=this.objectReferences,c;if(b.__archiveReference){c=b.__archiveReference;a[c].count++;return c}c=++this._uid;a[c]={object:b,count:1};b.__archiveReference=c;return c};iAd.Archiver.objectForReference=function(c){var a=this.objectReferences;var d=a[c];if(!d){return null}var b=d.object;d.count--;if(d.count<=0){delete a[c];delete b.__archiveReference}return b};