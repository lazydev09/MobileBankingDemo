
/**
*
* Copyright Â© 2009-2011 Apple Inc.  All rights reserved.
*
**/

iAd.Class({name:"iAd.Loader",mixins:[iAd.EventTarget],synthesizedProperties:["supportingObject","progress","url","resolvedURL","timeout"]});iAd.Loader.DID_START="loaderDidStart";iAd.Loader.DID_PROGRESS="loaderDidProgress";iAd.Loader.DID_COMPLETE="loaderDidComplete";iAd.Loader.DID_FAIL="loaderDidFail";iAd.Loader.NO_ERROR=0;iAd.Loader.LOAD_ERROR=1;iAd.Loader.LOAD_ABORTED=2;iAd.Loader.LOAD_TIMED_OUT=3;iAd.Loader.DEFAULT_TIMEOUT=0;iAd.Loader.prototype.init=function(a){this.callSuper();this._url=a;this._timeout=-1;this.delegate=null;this.loading=false;this.loaded=false;this.error=iAd.Loader.NO_ERROR;this.eventTarget=document};iAd.Loader.prototype.load=function(){if(this.loading){return false}this.loading=true;this.loaded=false;this.error=iAd.Loader.NO_ERROR;this.startTimeoutTimer();this.notifyLoaderDidStart();this.startLoad();return true};iAd.Loader.prototype.abort=function(){if(!this.loading||this.loaded){return false}this.loading=false;this.loaded=false;this.cancelTimeoutTimer();this.abortLoad();this.notifyLoaderDidFail(iAd.Loader.LOAD_ABORTED);return true};iAd.Loader.prototype.getProgress=function(){return this.loaded?1:0};iAd.Loader.prototype.setUrl=function(a){if(this.loading||this.loaded){iAd.Console.warn("iAd.Loader: You cannot change the url after starting the load.");return}this._url=a};iAd.Loader.prototype.getResolvedURL=function(){return iAd.Path.resolveAbsolutePath(this._url)};iAd.Loader.prototype.getTimeout=function(){return this._timeout>=0?this._timeout:this.constructor.DEFAULT_TIMEOUT};iAd.Loader.prototype.startLoad=function(){this.notifyLoaderDidFail(iAd.Loader.LOAD_ERROR)};iAd.Loader.prototype.abortLoad=function(){};iAd.Loader.prototype.startTimeoutTimer=function(){if(this.timeout>0){this.timeoutTimer=this.callMethodNameAfterDelay("handleTimeout",this.timeout)}};iAd.Loader.prototype.cancelTimeoutTimer=function(){if(this.timeoutTimer){clearTimeout(this.timeoutTimer)}this.timeoutTimer=null};iAd.Loader.prototype.handleTimeout=function(){this.notifyLoaderDidFail(iAd.Loader.LOAD_TIMED_OUT)};iAd.Loader.prototype.notifyLoaderDidStart=function(){this.loading=true;this.dispatchLoaderNotification(iAd.Loader.DID_START)};iAd.Loader.prototype.notifyLoaderDidProgress=function(){this.dispatchLoaderNotification(iAd.Loader.DID_PROGRESS,[["progress",this.progress]])};iAd.Loader.prototype.notifyLoaderDidFail=function(a){this.loading=false;this.error=a;this.dispatchLoaderNotification(iAd.Loader.DID_FAIL,[["error",(a||iAd.Loader.LOAD_ERROR)]])};iAd.Loader.prototype.notifyLoaderDidComplete=function(){this.loading=false;this.loaded=true;this.dispatchLoaderNotification(iAd.Loader.DID_COMPLETE)};iAd.Loader.prototype.dispatchLoaderNotification=function(a,b){this.dispatchNotification(a,this.delegate,b);this.notifyDelegate(a,this._manager,b)};